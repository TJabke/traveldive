<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TravelDive Â· Berater-Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>

<aside class="sidebar">
  <div class="sidebar-brand">Travel<span>Dive</span></div>
  <nav class="sidebar-nav">
    <div class="sidebar-item active" onclick="showView('overview')" data-view="overview">ğŸ“Š Ãœbersicht</div>
    <div class="sidebar-item" onclick="showView('editor')" data-view="editor">âœï¸ Tour bearbeiten</div>
    <div class="sidebar-item" onclick="showView('analytics')" data-view="analytics">ğŸ“ˆ Analytics</div>
  </nav>
  <div class="sidebar-user" onclick="showAgentSettings()" style="cursor:pointer;" title="Profil bearbeiten">
    <div class="sidebar-avatar" id="sidebarAvatar">?</div>
    <div><div class="sidebar-uname" id="sidebarName">Profil einrichten</div><div class="sidebar-urole" id="sidebarCompany">Klicken zum Bearbeiten</div></div>
  </div>
</aside>

<div class="main">

  <!-- â•â•â• OVERVIEW â•â•â• -->
  <div class="view-panel active" id="view-overview">
    <div class="header">
      <div class="header-title">Dashboard</div>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="newTour()">+ Neue Tour</button>
      </div>
    </div>
    <div class="content">
      <div class="stats-row" id="statsRow">
        <div class="stat-card"><div class="stat-label">Aktive Tours</div><div class="stat-value" id="statTours">â€“</div></div>
        <div class="stat-card"><div class="stat-label">Aufrufe (7 Tage)</div><div class="stat-value" id="statViews">â€“</div></div>
        <div class="stat-card"><div class="stat-label">Anfragen</div><div class="stat-value" id="statInquiries">â€“</div></div>
        <div class="stat-card"><div class="stat-label">Ã˜ Conversion</div><div class="stat-value" id="statConversion">â€“</div></div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸ“‹</span> Ihre Tours</div>
        </div>
        <div style="overflow-x:auto;">
          <table class="tour-table">
            <thead><tr>
              <th>Kunde</th><th>Reiseziel</th><th>Zeitraum</th><th>Hotels</th><th>Status</th><th>Aufrufe</th><th></th>
            </tr></thead>
            <tbody id="tourTableBody">
              <tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--text-muted);">Lade Tours...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• EDITOR â•â•â• -->
  <div class="view-panel" id="view-editor">
    <div class="header">
      <div style="display:flex;align-items:center;gap:.8rem;">
        <div class="header-title" id="editorTitle">Neue Tour</div>
        <span class="badge badge-draft" id="editorBadge"><span class="badge-dot"></span> Entwurf</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-ghost" onclick="showView('overview')">â† ZurÃ¼ck</button>
        <button class="btn" onclick="openPreview()" id="btnPreview" style="display:none;">ğŸ‘ Vorschau</button>
        <div class="share-box" id="shareBox" style="display:none;">
          <input readonly id="shareLink">
          <button class="btn btn-sm" onclick="copyLink()">Kopieren</button>
        </div>
        <button class="btn" onclick="saveTour()">ğŸ’¾ Speichern</button>
        <button class="btn btn-sunset" onclick="publishTour()" id="btnPublish">ğŸš€ VerÃ¶ffentlichen</button>
      </div>
    </div>
    <div class="content">

      <!-- BASICS -->
      <div class="card">
        <div class="card-header"><div class="card-title"><span class="icon">ğŸ‘¤</span> Kunde & Reise</div></div>
        <div class="card-body">
          <div class="form-row three">
            <div class="form-group"><label class="form-label">Kunde</label><input class="form-input" id="fCustomer" placeholder="Vorname Nachname"></div>
            <div class="form-group"><label class="form-label">E-Mail</label><input class="form-input" id="fEmail" type="email" placeholder="kunde@email.de"></div>
            <div class="form-group"><label class="form-label">Reisezeitraum</label><div style="display:flex;gap:.4rem;"><input class="form-input" id="fDateFrom" type="date"><input class="form-input" id="fDateTo" type="date"></div></div>
          </div>
          <div class="form-row three">
            <div class="form-group"><label class="form-label">Reiseziel</label><input class="form-input" id="fDestination" placeholder="z.B. Kreta, Elounda"></div>
            <div class="form-group"><label class="form-label">Abflughafen</label>
              <select class="form-select" id="fAirport"><option value="">â€“ wÃ¤hlen â€“</option><option>MÃ¼nchen (MUC)</option><option>Frankfurt (FRA)</option><option>DÃ¼sseldorf (DUS)</option><option>Hamburg (HAM)</option><option>Berlin (BER)</option><option>Stuttgart (STR)</option><option>KÃ¶ln (CGN)</option><option>Wien (VIE)</option><option>ZÃ¼rich (ZRH)</option></select>
            </div>
            <div class="form-group"><label class="form-label">Verpflegung</label>
              <select class="form-select" id="fMealPlan"><option>All-Inclusive</option><option>Halbpension</option><option>FrÃ¼hstÃ¼ck</option><option>Nur Ãœbernachtung</option></select>
            </div>
          </div>
          <div class="form-row three">
            <div class="form-group"><label class="form-label">Reiseprofil</label>
              <select class="form-select" id="fTravelerType">
                <option value="family">Familie mit Kindern</option>
                <option value="solo">Alleinreisend</option>
                <option value="couple">PÃ¤rchen</option>
              </select>
              <div class="form-hint">Steuert TonalitÃ¤t und passende GÃ¤stebewertungen.</div>
            </div>
          </div>
          <div class="form-group full">
            <label class="form-label">Kundenvorlieben</label>
            <div class="form-hint" style="margin-bottom:.3rem;">Beeinflussen KI-generierte Inhalte (Tagesplan, Empfehlungen)</div>
            <div class="pref-tags" id="prefTags"></div>
          </div>
          <div class="form-group full" style="margin-top:.8rem;">
            <label class="form-label">PersÃ¶nliche Notiz an den Kunden</label>
            <textarea class="form-textarea" id="fNote" rows="2" placeholder="z.B. 'Frau Schmidt, ich habe Hotels mit Kinderpool fÃ¼r Sie rausgesuchtâ€¦'"></textarea>
          </div>
          <div class="form-group full" style="margin-top:.8rem;">
            <label class="form-label">Hero YouTube Video URL (optional)</label>
            <input class="form-input" id="fHeroVideo" placeholder="https://www.youtube.com/watch?v=...">
          </div>
        </div>
      </div>

      <!-- HOTELS -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸ¨</span> Hotels <span style="font-weight:400;color:var(--text-muted);font-size:.76rem;" id="hotelCount"></span></div>
          <button class="btn btn-sm btn-primary" onclick="addHotel()">+ Hotel hinzufÃ¼gen</button>
        </div>
        <div class="card-body" id="hotelList">
          <div class="info-note">ğŸ’¡ FÃ¼gen Sie Hotels hinzu und klicken Sie "KI generieren" um automatisch Beschreibungen, Restaurants, Pools und Zimmerinfos zu erstellen.</div>
        </div>
      </div>


      <!-- ROOM CATEGORIES -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸ›</span> Zimmerkategorie fÃ¼r Kundenseite</div>
          <button class="btn btn-sm btn-primary" onclick="addRoomOption()">+ Zimmerkategorie</button>
        </div>
        <div class="card-body">
          <div class="form-row" style="margin-bottom:.7rem;align-items:flex-end;">
            <div class="form-group" style="flex:1;">
              <label class="form-label">Hotel-URL fÃ¼r Zimmerdaten (optional)</label>
              <input class="form-input" id="roomSourceUrl" placeholder="https://hotel.example/rooms">
              <div class="form-hint">Extrahiert Zimmertypen + Ausstattungsmerkmale (ohne Preise/VerfÃ¼gbarkeit).</div>
            </div>
            <div class="form-group" style="margin-left:.5rem;">
              <button class="btn btn-sm" onclick="extractRoomsForCurrentHotel()">ğŸ” Zimmer extrahieren</button>
            </div>
          </div>
          <div id="roomCategoryInfo" class="form-hint" style="margin-bottom:.6rem;">Bitte zuerst ein Hotel auswÃ¤hlen.</div>
          <div class="editable-list" id="roomCategoryList"></div>
        </div>
      </div>

      <!-- POIs -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸ“</span> Umgebung & SehenswÃ¼rdigkeiten</div>
          <div style="display:flex;gap:.4rem;">
            <button class="btn btn-sm" onclick="generatePOIs()">ğŸ”„ KI generieren</button>
            <button class="btn btn-sm btn-primary" onclick="addItem('poi')">+ Eigenen Tipp</button>
          </div>
        </div>
        <div class="card-body">
          <div class="editable-list" id="poiList"></div>
          <div class="generating" id="poiGenerating"><div class="gen-spinner"></div>KI generiert VorschlÃ¤geâ€¦</div>
          <div class="add-item-row" onclick="addItem('poi')" style="margin-top:.5rem;">+ Eigenen Ort hinzufÃ¼gen</div>
        </div>
      </div>

      <!-- DAY PLAN -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸ“…</span> Tagesplan</div>
          <div style="display:flex;gap:.4rem;">
            <button class="btn btn-sm" onclick="generateDayPlan()">ğŸ”„ KI generieren</button>
            <button class="btn btn-sm btn-primary" onclick="addItem('day')">+ Eintrag</button>
          </div>
        </div>
        <div class="card-body">
          <div class="editable-list" id="dayList"></div>
          <div class="generating" id="dayGenerating"><div class="gen-spinner"></div>KI erstellt Tagesplanâ€¦</div>
          <div class="add-item-row" onclick="addItem('day')" style="margin-top:.5rem;">+ Eintrag hinzufÃ¼gen</div>
        </div>
      </div>

      <!-- TRANSFERS -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><span class="icon">ğŸš</span> Transfer-Optionen</div>
          <div style="display:flex;gap:.4rem;">
            <button class="btn btn-sm" onclick="generateTransfers()">ğŸ”„ KI generieren</button>
            <button class="btn btn-sm btn-primary" onclick="addItem('transfer')">+ Option</button>
          </div>
        </div>
        <div class="card-body">
          <div class="editable-list" id="transferList"></div>
          <div class="generating" id="transferGenerating"><div class="gen-spinner"></div>KI generiert Transfer-Optionenâ€¦</div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• ANALYTICS â•â•â• -->
  <div class="view-panel" id="view-analytics">
    <div class="header">
      <div class="header-title">Analytics</div>
      <div class="header-actions">
        <select class="form-select" id="analyticsTourSelect" style="width:250px;font-size:.82rem;" onchange="loadAnalytics(this.value)">
          <option value="">Tour auswÃ¤hlenâ€¦</option>
        </select>
      </div>
    </div>
    <div class="content">
      <div id="analyticsContent">
        <div style="text-align:center;padding:3rem;color:var(--text-muted);">WÃ¤hlen Sie eine Tour aus, um die Analytics zu sehen.</div>
      </div>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <h3 id="modalTitle">Bearbeiten</h3>
    <div id="modalBody"></div>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal()">Abbrechen</button>
      <button class="btn btn-primary" id="modalSave" onclick="saveModalItem()">Speichern</button>
    </div>
  </div>
</div>

<script src="/js/api.js"></script>
<script src="/js/dashboard.js"></script>
</body>
</html>
